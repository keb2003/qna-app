<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Q&A App with GitHub Sync & Clipboard</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  input, textarea { width: 100%; margin-bottom: 8px; padding: 8px; }
  button { margin: 4px 0; }
  .qa-item { border: 1px solid #ccc; padding: 8px; margin-bottom: 8px; }
  .answer { white-space: pre-wrap; background: #f9f9f9; padding: 6px; }
</style>
</head>
<body>

<h1>Q&A App</h1>

<label>GitHub Token: <input type="password" id="tokenInput" placeholder="Paste your GitHub token" /></label>
<button id="saveTokenBtn">Save Token</button>

<hr />

<h2>Add Q&A</h2>
<input id="questionInput" placeholder="Question" />
<textarea id="answerInput" rows="3" placeholder="Answer"></textarea>
<button id="addQAButton">Add Q&A</button>

<hr />

<h2>Q&A List</h2>
<div id="qaList"></div>

<hr />

<button id="loadBtn">Load from GitHub</button>
<button id="saveBtn">Save to GitHub</button>

<script>
const OWNER = 'keb2003';
const REPO = 'qna-app';
const FILE_PATH = 'qa_data.json';
const API_URL = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}`;

let qaData = {};
let currentSha = null;

function renderQA() {
  const container = document.getElementById('qaList');
  container.innerHTML = '';
  for (const q in qaData) {
    const div = document.createElement('div');
    div.className = 'qa-item';
    div.innerHTML = `
      <strong>Q:</strong> ${q} <br/>
      <strong>A:</strong> <pre class="answer">${qaData[q]}</pre>
      <button class="copyBtn">Copy Answer</button>
      <button class="deleteBtn">Delete</button>
    `;
    // Copy button
    div.querySelector('.copyBtn').onclick = () => {
      navigator.clipboard.writeText(qaData[q]).then(() => {
        alert('Answer copied to clipboard!');
      });
    };
    // Delete button
    div.querySelector('.deleteBtn').onclick = () => {
      if (confirm('Delete this Q&A?')) {
        delete qaData[q];
        renderQA();
      }
    };
    container.appendChild(div);
  }
}

document.getElementById('saveTokenBtn').onclick = () => {
  const token = document.getElementById('tokenInput').value.trim();
  if (token) {
    localStorage.setItem('githubToken', token);
    alert('Token saved!');
  } else {
    alert('Please enter a token.');
  }
};

document.getElementById('addQAButton').onclick = () => {
  const q = document.getElementById('questionInput').value.trim();
  const a = document.getElementById('answerInput').value.trim();
  if (!q || !a) {
    alert('Please enter both question and answer.');
    return;
  }
  qaData[q] = a;
  document.getElementById('questionInput').value = '';
  document.getElementById('answerInput').value = '';
  renderQA();
};

document.getElementById('loadBtn').onclick = async () => {
  const token = localStorage.getItem('githubToken');
  if (!token) return alert('Save your GitHub token first.');

  try {
    const res = await fetch(API_URL, {
      headers: { Authorization: `Bearer ${token}` },
    });
    if (!res.ok) throw new Error('Failed to load file from GitHub');

    const data = await res.json();
    currentSha = data.sha;
    const content = atob(data.content);
    qaData = JSON.parse(content);
    renderQA();
    alert('Loaded from GitHub!');
  } catch (err) {
    alert(err.message);
  }
};

document.getElementById('saveBtn').onclick = async () => {
  const token = localStorage.getItem('githubToken');
  if (!token) return alert('Save your GitHub token first.');

  try {
    const contentBase64 = btoa(unescape(encodeURIComponent(JSON.stringify(qaData, null, 2))));
    const body = {
      message: 'Update Q&A',
      content: contentBase64,
      sha: currentSha,
    };

    const res = await fetch(API_URL, {
      method: 'PUT',
      headers: {
        Authorization: `Bearer ${token}`,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(body),
    });

    if (!res.ok) {
      const text = await res.text();
      throw new Error('GitHub save failed: ' + text);
    }

    const resData = await res.json();
    currentSha = resData.content.sha;
    alert('Saved to GitHub!');
  } catch (err) {
    alert(err.message);
  }
};

renderQA();
</script>

</body>
</html>
